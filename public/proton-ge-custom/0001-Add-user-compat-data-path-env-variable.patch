From cc245a61bc69a01226a5d055582b186a241b0fff Mon Sep 17 00:00:00 2001
From: Stelios Tsampas <loathingkernel@gmail.com>
Date: Mon, 27 Jun 2022 01:20:04 +0300
Subject: [PATCH] Add user compat data path env variable

---
 proton | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/proton b/proton
index 198c662d..96329513 100755
--- a/proton
+++ b/proton
@@ -1673,6 +1673,15 @@ if __name__ == "__main__":
         log("No compat data path?")
         sys.exit(1)
 
+    if "PROTON_USER_COMPAT_DATA" in os.environ:
+        if nonzero(os.environ["PROTON_USER_COMPAT_DATA"]):
+            compatpath = os.environ["STEAM_COMPAT_DATA_PATH"].split('/')
+            os.environ["STEAM_COMPAT_DATA_PATH"] = "{}/{}/{}/{}".format(
+                os.environ["STEAM_COMPAT_CLIENT_INSTALL_PATH"],
+                compatpath[-3], compatpath[-2], compatpath[-1])
+            if not os.path.exists(os.environ["STEAM_COMPAT_DATA_PATH"]):
+                os.makedirs(os.environ["STEAM_COMPAT_DATA_PATH"])
+
     g_proton = Proton(os.path.dirname(sys.argv[0]))
 
     g_proton.cleanup_legacy_dist()
-- 
2.37.1

